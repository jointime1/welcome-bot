import type { Conversation } from "@grammyjs/conversations";
import { InlineKeyboard } from "grammy";
import type { MyContext } from "index";

export async function onboarding(
  conversation: Conversation<MyContext, MyContext>,
  ctx: MyContext
) {
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —à–∞–≥–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
  const steps = [
    {
      text: `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ! –Ø –±–æ—Ç IT-–•–û–ó–Ø–ï–í. –ü—Ä–∏–∑–≤–∞–Ω –ø–æ–º–æ—á—å –≤–∫–∞—Ç–∏—Ç—å—Å—è —Ç–µ–±–µ –ø–æ –ø–æ–ª–Ω–æ–π

–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å, –Ω–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ`,
      keyboard: new InlineKeyboard().text("–ù–∞—á–∞—Ç—å", "start"),
    },
    {
      text: `–û—Ç–ª–∏—á–Ω–æ, —Ç–æ–≥–¥–∞ –¥–∞–≤–∞–π –æ—Ç–ø—Ä–∞–≤–∏–º—Å—è –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ –Ω–∞—à–µ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É!

–ù–µ –±–µ—Å–ø–æ–∫–æ–π—Å—è, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –∑–∞–±—É–¥–µ—à—å. –í—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —á–∞—Ç–æ–≤ –ø–æ –∫–æ–º–∞–Ω–¥–µ /menu

–ü–µ—Ä–≤—ã–π —á–∞—Ç - IT-–•–û–ó–Ø–ï–í–ê. –¢—É—Ç –º–æ–∂–Ω–æ –æ–±—â–∞—Ç—å—Å—è –Ω–∞ –ª—é–±—ã–µ —Ç–µ–º—ã, –¥–∞–∂–µ –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å IT

–¢—ã –≥–æ—Ç–æ–≤ —É–∑–Ω–∞—Ç—å –ø—Ä–æ —Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞?`,
      keyboard: new InlineKeyboard().text("–î–∞", "ready"),
    },
    {
      text: `<b>–û—Ç–ª–∏—á–Ω–æ!</b> –î–∞–≤–∞–π –ø—Ä–æ–∫–∞—á–∞–µ–º —Ç–µ–±—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏. –£ –Ω–∞—Å –≤ –±–µ—Å–µ–¥–∞—Ö –∫—É—á–∞ —Å–µ–Ω—å–æ—Ä–æ–≤, –≥–æ—Ç–æ–≤—ã—Ö –ø–æ–º–æ—á—å.

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è –∑–Ω–∞–Ω–∏–π –≤–ª–∏–≤–∞–π—Å—è –≤ —á–∞—Ç—ã:
<b>‚Ä¢ IT-X: –ù–æ–≤–∏—á–∫–∏ –≤ IT</b> - –±–∞–∑–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã
<b>‚Ä¢ IT-X: IT (–ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–π)</b> - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è
<b>‚Ä¢ IT-X: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–Ω–∏–∂–Ω—ã–π –∫–ª—É–±</b> - –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∫–Ω–∏–≥

–°–æ–≤–µ—Ç—É—é –≤—Å—Ç—É–ø–∏—Ç—å –≤ —á–∞—Ç —Ç–≤–æ–µ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
<b>‚Ä¢ IT-X: JS –±–∞–Ω–¥–∞</b> - —Å–µ–º–∏–Ω–∞—Ä—ã –ø–æ JavaScript
<b>‚Ä¢ IT-X: Golang</b> - –∏–∑—É—á–µ–Ω–∏–µ Golang
<b>‚Ä¢ IT-X: DevOps, linux, —Å–µ—Ç–∏</b> - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–µ—Ç–∏`,
      parse_mode: "HTML",
      keyboard: new InlineKeyboard().text("–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", "next"),
    },
    {
      text: `<b>IT-X: –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è</b> - –°–ª–∏–≤—ã –∫—É—Ä—Å–æ–≤ –∏ –ø–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

–ü–æ–Ω–∏–º–∞—é, —á—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–ª–æ–∂–Ω–∞—è, –Ω–æ —ç—Ç–æ –¥–ª—è —Ç–≤–æ–µ–≥–æ –±–ª–∞–≥–∞! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º?`,
      parse_mode: "HTML",
      keyboard: new InlineKeyboard().text("–î–∞–ª–µ–µ", "next"),
    },
    {
      text: `<b>–ß–∞—Ç—Ç–∏–Ω–≥ –∏ –æ—Ç–¥—ã—Ö:</b>
<b>‚Ä¢ IT-X: –°–ø–æ—Ä—Ç</b> - —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏ –ø–∏—Ç–∞–Ω–∏–µ
<b>‚Ä¢ IT-X: –ö—Ä–∏–ø—Ç–∞ –∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</b> - —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è
<b>‚Ä¢ IT-X: –ú–æ—Å–∫–≤–∞</b> - –º–µ—Å—Ç–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏
<b>‚Ä¢ IT-X: –ê–Ω–∏–º–µ –∏ –º–∞–Ω–≥–∞</b> - –∞–Ω–∏–º–µ-—Å–æ–æ–±—â–µ—Å—Ç–≤–æ
<b>‚Ä¢ IT-X: –ï–¥–∞</b> - –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–µ —à–µ–¥–µ–≤—Ä—ã
<b>‚Ä¢ IT-X: –ò–≥—Ä—ã</b> - –∏–≥—Ä–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏

–û—Å—Ç–∞–ª—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥! –ó–∞–≤–µ—Ä—à–∞–µ–º?`,
      parse_mode: "HTML",
      keyboard: new InlineKeyboard().text("–ó–∞–≤–µ—Ä—à–∏—Ç—å", "finish"),
    },
    {
      text: "üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –¢—ã –∑–∞–≤–µ—Ä—à–∏–ª –æ–Ω–±–æ—Ä–¥–∏–Ω–≥. –¢–µ–ø–µ—Ä—å —Ç—ã –ø–æ–ª–Ω–æ–ø—Ä–∞–≤–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –Ω–∞—à–µ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞! –í—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –º–µ–Ω—é —á–µ—Ä–µ–∑ /menu",
      keyboard: new InlineKeyboard(),
    },
  ];

  try {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    const message = await ctx.reply(steps[0].text, {
      reply_markup: steps[0].keyboard,
      parse_mode: "HTML",
    });
    let currentStep = 0;

    // ... –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–¥ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è

    while (currentStep < steps.length - 1) {
      // –ñ–¥–µ–º –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç callback query
      const result = await conversation.waitFor("callback_query:data");
      const callbackQuery = result.callbackQuery;

      // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–≥
      currentStep++;

      // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
      await ctx.api.editMessageText(
        ctx.chat!.id,
        message.message_id,
        steps[currentStep].text,
        {
          parse_mode: "HTML",
          reply_markup: steps[currentStep].keyboard,
        }
      );

      // –Ø–≤–Ω–æ –æ—Ç–≤–µ—á–∞–µ–º –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π callback query
      await ctx.api.answerCallbackQuery(callbackQuery.id);
    }

    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞:", error);
    await ctx.reply("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
  }
}
